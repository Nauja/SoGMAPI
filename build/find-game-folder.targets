<!--

This MSBuild file detects the Stardew Valley install path if possible, and sets the 'GamePath'
property.

-->
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- import developer's custom path (if any) -->
  <Import Condition="$(OS) != 'Windows_NT' AND Exists('$(HOME)\secretsofgrindea.targets')" Project="$(HOME)\secretsofgrindea.targets" />
  <Import Condition="$(OS) == 'Windows_NT' AND Exists('$(USERPROFILE)\secretsofgrindea.targets')" Project="$(USERPROFILE)\secretsofgrindea.targets" />

  <!-- find game path -->
  <Choose>
    <When Condition="$(OS) == 'Windows_NT'">
      <PropertyGroup>
        <!-- registry paths -->
        <GamePath Condition="!Exists('$(GamePath)')">$([MSBuild]::GetRegistryValueFromView('HKEY_LOCAL_MACHINE\SOFTWARE\GOG.com\Games\1453375253', 'PATH', null, RegistryView.Registry32))</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">$([MSBuild]::GetRegistryValueFromView('HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\Steam App 269770', 'InstallLocation', null, RegistryView.Registry64, RegistryView.Registry32))</GamePath>

        <!-- derive from Steam library path -->
        <_SteamLibraryPath>$([MSBuild]::GetRegistryValueFromView('HKEY_CURRENT_USER\SOFTWARE\Valve\Steam', 'SteamPath', null, RegistryView.Registry32))</_SteamLibraryPath>
        <GamePath Condition="!Exists('$(GamePath)') AND '$(_SteamLibraryPath)' != ''">$(_SteamLibraryPath)\steamapps\common\SecretsOfGrindea</GamePath>

        <!-- GOG paths -->
        <GamePath Condition="!Exists('$(GamePath)')">C:\Program Files\GalaxyClient\Games\SecretsOfGrindea</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">C:\Program Files\GOG Galaxy\Games\SecretsOfGrindea</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">C:\Program Files\GOG Games\SecretsOfGrindea</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">C:\Program Files (x86)\GalaxyClient\Games\SecretsOfGrindea</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">C:\Program Files (x86)\GOG Galaxy\Games\SecretsOfGrindea</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">C:\Program Files (x86)\GOG Games\SecretsOfGrindea</GamePath>

        <!-- Xbox app paths -->
        <!--
        The Xbox app saves the install path to the registry, but we can't use it here since it
        saves the internal readonly path (like C:\Program Files\WindowsApps\Mutable\<package ID>)
        instead of the mods-enabled path (like C:\Program Files\ModifiableWindowsApps\SecretsOfGrindea).
        Fortunately we can cheat a bit: players can customize the install drive, but they can't
        change the install path on the drive.
        -->
        <GamePath Condition="!Exists('$(GamePath)')">C:\Program Files\ModifiableWindowsApps\SecretsOfGrindea</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">D:\Program Files\ModifiableWindowsApps\SecretsOfGrindea</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">E:\Program Files\ModifiableWindowsApps\SecretsOfGrindea</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">F:\Program Files\ModifiableWindowsApps\SecretsOfGrindea</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">G:\Program Files\ModifiableWindowsApps\SecretsOfGrindea</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">H:\Program Files\ModifiableWindowsApps\SecretsOfGrindea</GamePath>

        <!-- Steam paths -->
        <GamePath Condition="!Exists('$(GamePath)')">C:\Program Files\Steam\steamapps\common\SecretsOfGrindea</GamePath>
        <GamePath Condition="!Exists('$(GamePath)')">C:\Program Files (x86)\Steam\steamapps\common\SecretsOfGrindea</GamePath>
      </PropertyGroup>
    </When>
  </Choose>
</Project>
